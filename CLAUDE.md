# Claude Code Development Rules

このファイルはClaude Codeによる開発時のルールと制約を定義します。

## Git Hooks (lefthook) ルール

### 必須制約
- **LEFTHOOK=0による無効化は禁止** - lefthookのテストやlintチェックを無効化してはいけません
- **品質基準の遵守** - すべてのコミットとプッシュは品質チェックを通過する必要があります
- **テスト必須** - 関連するテストが存在する場合は実行して合格する必要があります

### 対応方針
lefthookでエラーが発生した場合の対処順序：

1. **エラー修正を優先** - lint/testエラーは必ず修正してからコミット
2. **段階的修正** - 大量のエラーがある場合は分割して修正
3. **適切なコミット分割** - 修正内容ごとに適切にコミットを分割

### 例外処理
lefthookを無効化する代わりに以下を実行：
- エラーファイルの修正
- テスト対象外ファイルの除外設定
- 設定ファイルの調整

## テスト実行ルール

### テスト戦略
- **統合テスト中心** - 品質保証は主に統合テスト(integration tests)で実施
- **実環境に近い検証** - モック使用を最小限に抑え、実際のサービス連携をテスト
- **段階的統合** - unit testは保守性を考慮して統合テストに段階的に統合

### 環境設定
- `NODE_ENV=test` を設定してテスト実行
- Redis等の外部依存関係はテスト用設定を使用
- 統合テスト用のモック/スタブを適切に設定
- カスタムRedisヘルスチェックスクリプトを使用

### 品質基準
- ESLintエラーは0にする
- 統合テストカバレッジ基準を満たす（80%以上）
- セキュリティチェックを通過

## デプロイメントルール

### CI/CD パイプライン
- GitHub Actionsで自動テスト実行
- Redis等のサービス依存関係を適切に設定
- 環境固有の設定ファイルを使用

### 品質ゲート
- すべてのテストが合格
- lintチェックが合格
- セキュリティスキャンが合格

---

**重要**: これらのルールに従うことで、コードの品質と安全性を確保します。lefthookの無効化は品質低下につながるため厳禁です。