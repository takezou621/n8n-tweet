# Claude Code Development Rules

このファイルはClaude Codeによる開発時のルールと制約を定義します。

## Git Hooks (lefthook) ルール

### 必須制約
- **LEFTHOOK=0による無効化は禁止** - lefthookのテストやlintチェックを無効化してはいけません
- **品質基準の遵守** - すべてのコミットとプッシュは品質チェックを通過する必要があります
- **テスト必須** - 関連するテストが存在する場合は実行して合格する必要があります

### 対応方針
lefthookでエラーが発生した場合の対処順序：

1. **エラー修正を優先** - lint/testエラーは必ず修正してからコミット
2. **段階的修正** - 大量のエラーがある場合は分割して修正
3. **適切なコミット分割** - 修正内容ごとに適切にコミットを分割

### 例外処理
lefthookを無効化する代わりに以下を実行：
- エラーファイルの修正
- テスト対象外ファイルの除外設定
- 設定ファイルの調整

## テスト実行ルール

### テスト戦略
- **統合テスト中心** - 品質保証は主に統合テスト(integration tests)で実施
- **実環境に近い検証** - モック使用を最小限に抑え、実際のサービス連携をテスト
- **段階的統合** - unit testは保守性を考慮して統合テストに段階的に統合

### 環境設定
- `NODE_ENV=test` を設定してテスト実行
- Redis等の外部依存関係はテスト用設定を使用
- 統合テスト用のモック/スタブを適切に設定
- カスタムRedisヘルスチェックスクリプトを使用

### 品質基準
- ESLintエラーは0にする
- 統合テストカバレッジ基準を満たす（80%以上）
- セキュリティチェックを通過

## デプロイメントルール

### CI/CD パイプライン
- GitHub Actionsで自動テスト実行
- Redis等のサービス依存関係を適切に設定
- 環境固有の設定ファイルを使用

### 品質ゲート
- すべてのテストが合格
- lintチェックが合格
- セキュリティスキャンが合格

## .kiro プロジェクト仕様管理

### プロジェクト概要
- **システム名**: n8n-tweet - AI情報収集・配信システム
- **目的**: RSS フィードからAI関連情報を自動収集し、Twitter/X に厳選されたコンテンツを自動投稿
- **ターゲット**: 研究者、開発者、AI愛好家向けの完全自動化システム
- **アーキテクチャ**: n8n ワークフローエンジンとNode.js バックエンドによるマイクロサービス構成

### .kiro ディレクトリ構造
```
.kiro/
├── steering/          # プロジェクト方針・技術仕様
│   ├── product.md     # 製品概要と主要機能
│   ├── structure.md   # プロジェクト構造・アーキテクチャパターン
│   └── tech.md        # 技術スタック・ビルドシステム
└── specs/             # 詳細仕様書
    └── n8n-tweet-system/
        ├── requirements.md  # 要件定義書
        ├── design.md       # 設計仕様書
        └── tasks.md        # 実装タスク計画
```

### 主要機能
1. **RSS フィード処理** - ArXiv、OpenAI Blog、Google AI Blog等からの自動収集
2. **コンテンツフィルタリング** - AI関連度スコアリングと品質評価
3. **ツイート生成** - 280文字最適化、ハッシュタグ・URL付き自動生成
4. **Twitter統合** - Twitter API v2による自動投稿、レート制限・重複検出対応
5. **監視・分析** - ヘルスチェック、メトリクス収集、ツイート履歴追跡
6. **完全自動化** - Docker Compose によるワンクリックセットアップ・デプロイ

### 技術要件
- **ランタイム**: Node.js 18+ (ES2022)
- **ワークフローエンジン**: n8n v1.100.1+
- **データベース**: PostgreSQL (n8n用)、Redis (キャッシュ・セッション管理)
- **テスト**: Jest、TDD アプローチ、85%以上カバレッジ必須
- **品質管理**: ESLint Standard、Prettier、lefthook git hooks

### 開発アプローチ
- **モジュラー設計** - 単一責任の原則、依存性注入、インターフェース統一
- **エラーハンドリング** - グレースフル・デグラデーション、構造化ログ、リトライロジック
- **設定管理** - 環境変数、JSON設定、階層的設定上書き

---

**重要**: これらのルールに従うことで、コードの品質と安全性を確保します。lefthookの無効化は品質低下につながるため厳禁です。